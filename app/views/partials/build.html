<!-- <div ng-include="'partials/navbar'"></div> -->

<div class="main-container-fixed">
    <div class="main-container-tr" 
        ng-controller="BuildCtrl">

        <div class="col-lg-5 col-md-5 col-sm-5 container-col panel-left-col result-plot-col"
            ng-show="leftPanel == 'ResultPlot'"
            ng-controller="ResultPlotCtrl"
            left-panel>
            <div class="col-head row text-center row">
                <h4>Plan Detail</h4>
            </div>
            
            <div class="ctn-plan-table-head">
                <table class="plan-table-head table table-striped table-condensed table-bordered table-hover">
                    <tbody>
                        <tr>
                            <td></td>
                            <td ng-repeat="day in days"><strong>{{day}}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="border-grad border-grad-top"><div></div></div>
            <div class="border-grad border-grad-btm"><div></div></div>
            
            <sf-perfect-scrollbar class="ctn-plan-table-main scroll-panel" 
                wheel-propagation="true" 
                wheel-speed="7" 
                ng-mousewheel="handleMouseWheel"
                update="updateScroll">
                <table class="plan-table-main table table-striped table-condensed table-bordered">
                    <tbody>
                        <tr ng-repeat="mark in timeMarks">
                            <td><span>{{mark.readable}}</span></td>
                            <td></td>
                            <td ng-repeat="slot in timeRow[mark.normalized]" rowspan="{{slot.rowspan}}">
                                <span>{{slot.courseCode}}</span>
                            </td>
                            <td ng-repeat="day in normalizedDays"
                                rowspan="{{timeSlot[day * 48 + mark.normalized].rowspan}}"
                                ng-show="timeSlot[day * 48 + mark.normalized].rowspan > 0"
                                ng-class="{'starter-mark': timeSlot[day * 48 + mark.normalized].rowspan > 1}">
                                <span>
                                    <strong>{{timeSlot[day * 48 + mark.normalized].courseCode}}</strong>
                                    {{timeSlot[day * 48 + mark.normalized].slotType}}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="ctn-btn ctn-btn-float">
                    <button 
                        class="btn btn-danger btn-block"
                        ng-click="close()">
                        <strong>Back to Filter</strong>
                    </button>
                </div>
            </sf-perfect-scrollbar>
            
            <div class="ctn-btn ctn-btn-fixed">
                <button 
                    class="btn btn-danger btn-block"
                        ng-click="close()">
                    <strong>Back to Filter</strong>
                </button>
            </div>
        </div>
        
        <div class="col-lg-5 col-md-5 col-sm-5 container-col panel-left-col course-pref-col"
            ng-show="leftPanel == 'Filter'"
            ng-controller="FilterCtrl"
            left-panel>

            <div class="col-head row text-center row"><h4>Filter</h4></div>


            <div class="ctn-course-table-head">
                <table class="course-table-head table table-striped table-condensed table-bordered">
                    <tbody>
                        <tr>
                            <td></td>
                            <td><strong>Courses</strong></td>
                            <td></td>
                            <td><strong>Indexes</strong></td>
                            <td popover="
                                Idexes that are not available in STARS Planner 
                                but you might be able to appeal for.
                                Click on the numbers to use these indexes." 
                                popover-trigger="mouseenter"
                                popover-placement="left">
                                <strong>N/A</strong>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <sf-perfect-scrollbar class="ctn-course-list scroll-panel" 
                wheel-propagation="true" 
                wheel-speed="7" 
                ng-mousewheel="handleMouseWheel"
                update="updateScroll" >
                <table class="course-table table table-striped table-condensed table-bordered" ng-show="(courseList.length > 0)">
                    <tbody ui-sortable ng-model="courseList"> 
                        <tr 
                            ng-repeat="course in courseList track by course.code"  
                            ng-class="{'course-filter-disabled': course.selected.none}"
                            title="{{course.code + ' - ' + course.title + ' (' + course.aus +' AU)'}}"
                            >
                            <td><strong>{{$index + 1}}</strong></td>
                            <td><strong>{{course.code}}</strong></td>
                            <td>
                                <button
                                    class="index-btn btn btn-xs"
                                    ng-class="{'btn-success': course.selected.all}"
                                    ng-click="toggleAll(course)">
                                    <i class="fa fa-fw fa-check"></i>
                                </button>
                            </td>
                            <td> 
                                <button 
                                    ng-repeat="index in course.indexes"
                                    class="index-btn btn btn-xs"
                                    ng-class="{
                                        'btn-success': index.selected, 
                                        'select-preview-positive': course.code == groupSelect.course.code && groupSelect.preview[$index] && groupSelect.selectType,
                                        'select-preview-negative': course.code == groupSelect.course.code && groupSelect.preview[$index] && !groupSelect.selectType
                                        }"
                                    ng-mousedown="handleMouseDownIndex(course, $index)"
                                    ng-mouseup="handleMouseUpIndex(course, $index)"
                                    ng-mouseenter="handleMouseEnterIndex(course, $index)"

                                    ng-show="index.visible || course.showHiddenIndex">
                                    {{index.code}}
                                </button>
                            </td>
                            <td title="Click to toggle">
                                <button 
                                    ng-click="toggleHiddenIndex(course)" 
                                    ng-disabled="course.hiddenIndexCount == 0" 
                                    ng-class="{'btn-success': course.showHiddenIndex}"
                                    class="btn btn-xs btn-hi">
                                    <span ng-show="course.showHiddenIndex" class="btn-hi-show">
                                        <strong>{{course.hiddenIndexCount}}</strong>
                                    </span>
                                    <span ng-show="!course.showHiddenIndex" ng-class="{'btn-hi-hide-hl': course.hiddenIndexCount > 0}" class="btn-hi-hide">
                                        <strong>{{course.hiddenIndexCount}}</strong>
                                    </span>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="ctn-btn ctn-btn-float">
                    <button 
                        class="btn btn-success btn-block find-btn find-btn-float"
                        ng-disabled="buildingStarted || courseList.length == 0"
                        ng-click="search()">
                        <strong>Find Possible Plans</strong>
                    </button>
                </div>
            </sf-perfect-scrollbar>

            <div class="border-grad border-grad-top"><div></div></div>
            <div class="border-grad border-grad-btm"><div></div></div>

            <div class="ctn-btn ctn-btn-fixed">
                <button 
                    class="btn btn-success btn-block find-btn find-btn-fixed"
                    ng-disabled="buildingStarted || courseList.length == 0"
                    ng-click="search()">
                    <strong>Find Possible Plans</strong>
                </button>
            </div>
        </div>

        <div class="col-lg-7 col-md-7 col-sm-7 container-col panel-right-col result-col" 
            ng-controller="ResultCtrl"
            result-panel> 
            <div class="row text-center col-head">
                <h4>
                    Possible Plans 
                    <span class="result-count-badge" ng-show="result.list">{{result.list.length}}</span>
                </h4>
            </div>

            <div class="ctn-result-table-head"
                ng-show="result.list.length > 0">
                <table class="result-table-head table table-striped table-condensed table-bordered">
                    <tbody>
                        <tr>
                            <td></td>
                            <td ng-repeat="code in result.courseOrder"><strong>{{code}}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="h5 text-center no-result-message"
                ng-show="result.list && result.list.length === 0">
                    <strong>Impossibruuu :(
                    <br>
                    Adding more Indexes or removing some Course might help.</strong>
            </div>

            <div ng-show="result.list.length > 0" class="border-grad border-grad-top"><div></div></div>
            <div ng-show="result.list.length > 0" class="border-grad border-grad-btm"><div></div></div>

            <sf-perfect-scrollbar class="ctn-result-list scroll-panel" 
                wheel-propagation="true" 
                wheel-speed="7" 
                ng-mousewheel="handleMouseWheel"
                update="updateScroll" >
                <table class="result-table table table-striped table-condensed table-bordered table-hover"
                    ng-class="{ 'table-plotting': rowActive != null }"
                    ng-show="(result.list.length > 0)" >
                    <tbody>
                        <tr ng-repeat="(k, indexArr) in result.list"
                            ng-show="k <= 15"
                            ng-mousedown="toggleResultPlot($index)"
                            ng-mouseenter="highlightResult($index)">
                            <td><strong>{{$index + 1}}</strong></td>
                            <td ng-repeat="index in indexArr"
                                ng-mouseenter="highlightCourse($index)">{{index}}</td>
                        </tr>
                    </tbody>
                </table>
            </sf-perfect-scrollbar>
        </div>
    </div>
</div>